package cmd

import (
	"context"
	"log"
	"os"
	"teng231/goapp/internal/app"
	"teng231/goapp/internal/infastructure/live"
	"teng231/goapp/internal/infastructure/sheetdb"
	"teng231/goapp/internal/interface/rest"
	"teng231/goapp/pkg/crypt"

	"github.com/spf13/cobra"
)

const cred = `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`

func StartCLI(cmd *cobra.Command, args []string) {
	hub, err := live.NewLiveHub()
	if err != nil {
		log.Fatalf("NewLiveHub error: %v", err)
	}

	key := os.Getenv("CREDENTIALS_KEY")
	credential, err := crypt.DecryptAES_CBC_Base64(cred, []byte(key))
	if err != nil {
		log.Fatalf("DecryptAES_CBC_Base64 error: %v", err)
	}
	sheetDB := sheetdb.NewSheetDB(
		context.TODO(),
		string(credential),
		os.Getenv("SPREADSHEET_ID"),
		os.Getenv("SHEET_NAME"))
	app := app.NewLiveCommentApp(hub, sheetDB)
	api := rest.New(app)
	api.Router().Listen(os.Getenv("PORT"))
}
